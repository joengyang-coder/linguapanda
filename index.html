<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LinguaPanda - Mobile Web App</title>
    <style>
        :root { --panda-green: #66bb6a; --gold: #ffca28; }
        body { margin: 0; background: #e8f5e9; font-family: 'Rounded Mplus 1c', sans-serif; overflow: hidden; touch-action: none; display: flex; flex-direction: column; align-items: center; }
        
        /* Progress Bar */
        #progress-bar { display: flex; gap: 15px; margin-top: 20px; }
        .star-slot { font-size: 35px; color: #ccc; transition: transform 0.3s; }
        .star-active { color: var(--gold); transform: scale(1.2); }

        /* Panda Area */
        .panda-container { position: relative; width: 100px; height: 100px; margin-top: 10px; }
        .panda-img { width: 100%; height: auto; transition: 0.3s; }
        .jump { animation: jump 0.5s ease; }
        @keyframes jump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        
        .msg-bubble { background: white; padding: 10px 20px; border-radius: 20px; margin: 10px; font-weight: bold; color: #2e7d32; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* Drawing Canvas */
        #canvas-box { position: relative; width: 300px; height: 300px; background: white; border: 8px solid var(--panda-green); border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .guide { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 220px; color: #f0f0f0; z-index: 1; user-select: none; }
        canvas { position: absolute; z-index: 2; border-radius: 22px; }

        /* Parent Gate Overlay */
        #gate { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; display: none; align-items: center; justify-content: center; color: white; }
        .gate-box { background: white; color: #333; padding: 30px; border-radius: 20px; text-align: center; }
        
        /* UI Buttons */
        .btn-parent { position: absolute; top: 15px; right: 15px; background: none; border: 2px solid #aaa; border-radius: 50%; width: 40px; height: 40px; color: #aaa; font-weight: bold; }
        .btn-reset { margin-top: 20px; padding: 12px 30px; border-radius: 25px; border: none; background: var(--panda-green); color: white; font-size: 18px; box-shadow: 0 4px 0 #388e3c; }
    </style>
</head>
<body>

    <button class="btn-parent" onclick="openGate()">P</button>

    <div id="progress-bar">
        <div class="star-slot" id="slot-1">‚òÜ</div>
        <div class="star-slot" id="slot-2">‚òÜ</div>
        <div class="star-slot" id="slot-3">‚òÜ</div>
    </div>

    <div class="panda-container">
        <img id="panda" class="panda-img" src="mascot-welcome.png">
    </div>

    <div class="msg-bubble" id="msg">Trace the line! Âä†Ê≤π!</div>

    <div id="canvas-box">
        <div class="guide" id="char-guide">‰∏Ä</div>
        <canvas id="paintCanvas" width="300" height="300"></canvas>
    </div>

    <button class="btn-reset" onclick="resetCanvas()">Start Over</button>

    <div id="gate">
        <div class="gate-box">
            <h2>Parents Only</h2>
            <p id="math-q"></p>
            <input type="number" id="gate-ans" style="width:80px; font-size:24px; text-align:center;"><br><br>
            <button onclick="checkGate()" style="padding:10px 20px;">Submit</button>
            <button onclick="closeGate()" style="background:none; border:none; color:blue;">Cancel</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById('paintCanvas');
    const ctx = canvas.getContext('2d');
    const msg = document.getElementById('msg');
    const panda = document.getElementById('panda');
    let drawing = false;
    let stars = 0;
    let currentWord = "‰∏Ä";

    ctx.strokeStyle = '#FFD700'; // Gold brush
    ctx.lineWidth = 20;
    ctx.lineCap = 'round';

    function startDraw(e) { drawing = true; draw(e); }
    function stopDraw() { 
        if(drawing) {
            speak("‰∏Ä");
            stars++;
            updateStars();
            panda.classList.add('jump');
            setTimeout(() => panda.classList.remove('jump'), 500);
            
            if(stars >= 3) {
                msg.innerHTML = "üéÅ GIFT TIME! You got a snack! üéã";
                stars = 0; 
                setTimeout(updateStars, 2000);
            } else {
                msg.innerText = "Great! Â§™Ê£í‰∫Ü!";
            }
        }
        drawing = false; 
        ctx.beginPath(); 
    }

    function draw(e) {
        if(!drawing) return;
        e.preventDefault();
        let t = e.touches ? e.touches[0] : e;
        let r = canvas.getBoundingClientRect();
        ctx.lineTo(t.clientX - r.left, t.clientY - r.top);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(t.clientX - r.left, t.clientY - r.top);
    }

    function updateStars() {
        for(let i=1; i<=3; i++) {
            let s = document.getElementById('slot-'+i);
            s.innerText = (i <= stars) ? "‚òÖ" : "‚òÜ";
            s.className = (i <= stars) ? "star-slot star-active" : "star-slot";
        }
    }

    function speak(t) {
        let u = new SpeechSynthesisUtterance(t);
        u.lang = 'zh-CN'; u.rate = 0.8; u.pitch = 1.2;
        window.speechSynthesis.speak(u);
    }

    function resetCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        msg.innerText = "Trace the line! Âä†Ê≤π!";
    }

    // Parent Gate Logic
    let gateAns = 0;
    function openGate() {
        let a = Math.floor(Math.random()*10), b = Math.floor(Math.random()*10);
        gateAns = a + b;
        document.getElementById('math-q').innerText = `What is ${a} + ${b}?`;
        document.getElementById('gate').style.display = 'flex';
    }
    function checkGate() {
        if(parseInt(document.getElementById('gate-ans').value) === gateAns) {
            alert("Settings Unlocked!"); closeGate();
        } else { alert("Try again!"); openGate(); }
    }
    function closeGate() { document.getElementById('gate').style.display = 'none'; }

    canvas.addEventListener('touchstart', startDraw);
    canvas.addEventListener('touchend', stopDraw);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mousemove', draw);
</script>
</body>
</html>
